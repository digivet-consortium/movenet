---
title: "Network analysis of livestock movement data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Network analysis of livestock movement data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
movenet uses the [Statnet suite of packages](https://statnet.org/packages/) (e.g. networkDynamic and tsna) for (temporal) social network analysis. We are currently working on the functions in this section - e.g. creation of a pdf report with network measures of particular relevance to disease transmission.

```{r setup}
library(movenet)

# Load example movenet-format movement and holding tibbles into the global environment:
movement_data <- head(example_movement_data, 100)
holding_data <- example_holding_data
```

## Generating a temporal network representation

We can generate a temporal network (networkDynamic) representation
of movement data and optional holding data, as follows:

```{R warning = FALSE}
# Create a networkDynamic from our data
network <- movedata2networkDynamic(movement_data, holding_data,
                                   incl_nonactive_holdings = FALSE)
network
```

## Calculate summary statistics for selected temporal network measures

This networkDynamic representation can then be used to calculate various network
summary measures, such as finding the maximum reachability in the network:

```{R}
max_reachability <- 
  parallel_summarise_temporal_node_properties(list(network), 
                                              n_threads = 1,
                                              node_property = "forward reachability",
                                              statistics = list(max = max),
                                              identify_nodes = TRUE)
unlist(max_reachability)
```


## Create a temporal social network analysis report

The movenet package provides a function to create a network analysis report,
with analyses of monthly network snapshots:

```{R eval=FALSE, echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
create_temporal_network_analysis_report(
  network,
  output_file = file.path(tempdir(),"network_report.html"),
  incl_reachability_analysis = FALSE,
  n_threads = 1,
  whole_months = TRUE,
  time_unit = "month")
```
This creates an html document that can be opened in a browser, and contains a
full report as shown below:

```{R, echo = FALSE}
htmltools::tags$iframe(title = "report",
                       src = ifelse(file.exists("../network_report.html"),
                                    "../network_report.html",
                                    system.file("reports/network_report.html", package = "movenet")),
                       width = "100%", height = 800)
```
